<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æé¾™æ™ºç›Šç­”é¢˜æ¸¸æˆ Demo</title>
<style>
    body {
        margin: 0;
        font-family: "Comic Sans MS", sans-serif;
        background: #b9e8ff;
        overflow: hidden;
    }
    #game {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: url('/static/images/pvz/background.png');
        background-size: cover;
        overflow: hidden;
    }
    .monster {
        position: absolute;
        width: auto;
        height: 100vh;
        transition: transform 0.2s;
    }
    @keyframes fly {
        from { transform: translateX(-50px) translateY(0); opacity: 1; }
        to { transform: translateX(100px) translateY(-50px) rotate(90deg); opacity: 0; }
    }
    @keyframes explode {
        from { transform: scale(1); opacity: 1; }
        to { transform: scale(2); opacity: 0; }
    }
    #answers {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    .ans-btn {
        padding: 15px 25px;
        background: #fff;
        border-radius: 12px;
        font-size: 20px;
        cursor: pointer;
        border: 3px solid #333;
        transition: 0.2s;
    }
    .ans-btn:hover {
        background: #ffe08a;
    }
    .bullet {
        position: absolute;
        width: 30px;
        height: 30px;
        background: url('/static/images/pvz/bullet.png');
        background-size: cover;
    }
    #questionBox {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 32px;
        background: rgba(255,255,255,0.8);
        padding: 10px 30px;
        border-radius: 15px;
        border: 3px solid #444;
    }
</style>
</head>
<body>

<div id="game">
    <div id="questionBox"></div>
    <div id="answers"></div>
</div>

<script>
const monsters = [
    { img: "/static/images/pvz/monster1.png", speed: (window.innerWidth - 150) / (10 * 60) }, // 10ç§’
    { img: "/static/images/pvz/monster2.png", speed: (window.innerWidth - 150) / (10 * 60) }, // 10ç§’
    { img: "/static/images/pvz/monster3.png", speed: (window.innerWidth - 150) / (10 * 60) }, // 10ç§’
];

let currentMonster = null;
let monsterX = window.innerWidth - 150;
let moving = true;

// ç¤ºä¾‹é¢˜åº“
const questions = [
    { q: "3 + 4 = ?", opts: ["5", "7", "9", "6"], right: 1 },
    { q: "8 - 3 = ?", opts: ["6", "5", "4", "3"], right: 1 },
    { q: "2 Ã— 6 = ?", opts: ["10", "11", "12", "14"], right: 2 },
];
let qi = 0;

function loadQuestion() {
    const qData = questions[qi];
    document.getElementById("questionBox").innerText = qData.q;

    let answers = document.getElementById("answers");
    answers.innerHTML = "";

    qData.opts.forEach((op, idx) => {
        let btn = document.createElement("div");
        btn.className = "ans-btn";
        btn.innerText = op;
        btn.onclick = () => checkAnswer(idx);
        answers.appendChild(btn);
    });
}

// åˆ›å»ºæ€ªå…½
function spawnMonster() {
    let m = monsters[Math.floor(Math.random() * monsters.length)];

    const img = document.createElement("img");
    img.src = m.img;
    img.className = "monster";
    img.style.left = monsterX + "px";
    img.style.top = "0";
    img.style.bottom = "0";

    img.dataset.speed = m.speed;

    document.getElementById("game").appendChild(img);
    currentMonster = img;

    moving = true;
    requestAnimationFrame(moveMonster);
}

// ç§»åŠ¨æ€ªå…½
function moveMonster() {
    if (!moving || !currentMonster) return;

    monsterX -= currentMonster.dataset.speed;

    currentMonster.style.left = monsterX + "px";

    if (monsterX < 80) {
        alert("âŒ æ¸¸æˆå¤±è´¥ï¼šæé¾™åƒæ‰äº†è›‹ï¼");
        location.reload();
        return;
    }

    requestAnimationFrame(moveMonster);
}

// å‘å°„å­å¼¹
function fireBullet(target) {
    const bullet = document.createElement("div");
    bullet.className = "bullet";

    bullet.style.left = "120px";
    bullet.style.top = "60%";

    document.getElementById("game").appendChild(bullet);

    let bx = 120;

    const timer = setInterval(() => {
        bx += 15;
        bullet.style.left = bx + "px";

        // æ£€æµ‹å‘½ä¸­
        const rectB = bullet.getBoundingClientRect();
        const rectM = target.getBoundingClientRect();

        if (rectB.right > rectM.left + 20) {
            clearInterval(timer);
            bullet.remove();
            killMonster(target);
        }

    }, 20);
}

// å‡»æ€æ€ªå…½
function killMonster(monster) {
    moving = false;

    monster.style.animation = "explode 0.6s forwards";

    setTimeout(() => monster.remove(), 500);

    setTimeout(() => nextQuestion(), 600);
}

function checkAnswer(idx) {
    const qData = questions[qi];
    if (idx === qData.right) {
        fireBullet(currentMonster);
    } else {
        // é”™è¯¯åˆ™æ€ªå…½åŠ é€Ÿ
        currentMonster.dataset.speed *= 1.5;
    }
}

function nextQuestion() {
    qi++;
    if (qi >= questions.length) {
        alert("ğŸ‰ æ­å–œå…¨éƒ¨ç­”å¯¹ï¼");
        location.reload();
        return;
    }
    monsterX = window.innerWidth - 150;
    loadQuestion();
    spawnMonster();
}

// åˆå§‹åŒ–
loadQuestion();
spawnMonster();
</script>
</body>
</html>
