# 项目架构图

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         用户浏览器                            │
│                    http://localhost:3002                     │
└────────────────────────┬────────────────────────────────────┘
                         │
                         │ HTTP 请求
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                      Flask 应用 (app.py)                     │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                      路由层                            │  │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────┐  │  │
│  │  │  页面路由  │ │  用户API  │ │  游戏API  │ │ 词库API  │  │
│  │  └──────────┘ └──────────┘ └──────────┘ └─────────┘  │  │
│  └─────────────────────────┬─────────────────────────────┘  │
│                            │                                 │
│  ┌─────────────────────────▼─────────────────────────────┐  │
│  │                     业务逻辑层                          │  │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────┐  │  │
│  │  │  用户认证  │ │  游戏逻辑  │ │  词库管理  │ │  会员系统 │  │
│  │  └──────────┘ └──────────┘ └──────────┘ └─────────┘  │  │
│  └─────────────────────────┬─────────────────────────────┘  │
└────────────────────────────┼─────────────────────────────────┘
                             │
            ┌────────────────┴────────────────┐
            ▼                                 ▼
   ┌────────────────┐               ┌────────────────┐
   │  MySQL 数据库   │               │ word_list.json │
   │                │               │                │
   │  • users       │               │  • word        │
   │  • members     │               │  • missing     │
   │  • scores      │               │  • type        │
   └────────────────┘               └────────────────┘
```

## 页面层次结构

```
登录页面 (login.html)
    │
    ├─ 登录成功
    │
    ▼
主页 (index.html) ───────────── 动态加载游戏列表 (/api/games)
    │
    ├─ 游戏1: 字字大冒险 (word-quest.html)
    │         │
    │         └─ 调用 API: GET /start
    │
    ├─ 游戏2: 乘法口诀表消消乐 (multiplication-game.html)
    │
    ├─ 用户管理 (user-management.html) ── 管理员专用
    │         │
    │         └─ 调用 API: GET /api/users
    │
    └─ 词库管理 (admin.html)
              │
              ├─ GET /api/words
              └─ POST /api/words
```

## 数据流图

### 1. 用户登录流程
```
┌──────┐    POST /api/login    ┌──────────┐    查询用户    ┌──────────┐
│ 用户 │ ───────────────────► │  Flask   │ ────────────► │  MySQL   │
└──────┘                       └──────────┘               └──────────┘
   ▲                                 │                          │
   │                                 │                          │
   │      设置 Session               │      ◄───────────────────┘
   │      跳转到主页                  │       返回用户信息
   │                                 │
   └─────────────────────────────────┘
```

### 2. 字字大冒险游戏流程
```
┌──────┐  访问 /word-quest  ┌──────────┐
│ 用户 │ ─────────────────► │  Flask   │
└──────┘                    └──────────┘
   │                             │ 返回 word-quest.html
   │                             ▼
   │                        ┌──────────┐
   │  GET /start            │ 前端页面  │
   │ ◄────────────────────  └──────────┘
   │                             │
   ▼                             ▼
┌──────────┐  读取词库      ┌──────────────┐
│  Flask   │ ────────────► │word_list.json│
└──────────┘               └──────────────┘
   │                             │
   │      ◄──────────────────────┘
   │       返回词库数据
   │
   │ JSON 数据（题目）
   ├─────────────────────►
   │                      ┌──────────┐
   │                      │ 前端页面  │
   │                      └──────────┘
   │                           │
   │                           │ 用户答题
   │                           │ 前端验证
   │                           ▼
   │                      显示结果
```

### 3. 词库管理流程
```
┌───────────┐  访问 /admin   ┌──────────┐
│  管理员   │ ──────────────► │  Flask   │
└───────────┘                └──────────┘
      │                           │ 返回 admin.html
      │                           ▼
      │                      ┌──────────┐
      │  GET /api/words      │ 管理页面  │
      │ ◄───────────────────  └──────────┘
      │                           │
      ▼                           ▼
┌──────────┐  读取          ┌──────────────┐
│  Flask   │ ────────────► │word_list.json│
└──────────┘               └──────────────┘
      │                           │
      │      ◄────────────────────┘
      │       返回词库列表
      │
      │ JSON 数据
      ├─────────────────────►
      │                      ┌──────────┐
      │                      │ 管理页面  │
      │                      └──────────┘
      │                           │
      │                           │ 增删改操作
      │                           │
      │  POST /api/words          │
      │ ◄─────────────────────────┘
      │
      ▼
┌──────────┐  验证数据
│  Flask   │  (最多40个)
└──────────┘  (格式检查)
      │
      │ 写入
      ▼
┌──────────────┐
│word_list.json│
└──────────────┘
```

## 模块依赖关系

```
app.py
  ├── 依赖: Flask
  ├── 依赖: PyMySQL
  ├── 依赖: config.py ──► MySQL 配置
  ├── 读取: word_list.json
  ├── 渲染: templates/*.html
  └── 提供: static/ 静态文件

templates/
  ├── index.html ──────► 调用 /api/games
  ├── login.html ──────► 调用 /api/login
  ├── word-quest.html ─► 调用 /start
  ├── admin.html ──────► 调用 /api/words
  └── user-management.html ─► 调用 /api/users

word_list.json
  └── 被 /api/words 和 /start 使用

MySQL 数据库
  ├── users 表 ──► 用户认证
  ├── members 表 ─► 会员系统
  └── scores 表 ──► 积分系统
```

## 认证流程

```
┌────────────────────────────────────────────────┐
│            所有需要登录的路由                    │
│   (/, /word-quest, /multiplication-game, etc)  │
└───────────────────┬────────────────────────────┘
                    │
                    │ 检查 session
                    ▼
        ┌───────────────────────┐
        │  session 中有 user_id? │
        └───────────────────────┘
            │             │
            │ 是          │ 否
            ▼             ▼
    ┌──────────┐    ┌──────────────┐
    │ 继续访问  │    │ redirect /login│
    └──────────┘    └──────────────┘
```

## API 端点映射

```
┌─────────────────────────────────────────┐
│              页面路由                    │
├─────────────────────────────────────────┤
│  GET  /                → index.html      │
│  GET  /login           → login.html      │
│  GET  /word-quest      → word-quest.html │
│  GET  /multiplication-game → xxx.html    │
│  GET  /admin           → admin.html      │
│  GET  /user-management → xxx.html        │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│              API 路由                    │
├─────────────────────────────────────────┤
│  POST /api/register    ─► 用户注册       │
│  POST /api/login       ─► 用户登录       │
│  POST /api/logout      ─► 用户登出       │
│  GET  /api/check-auth  ─► 检查登录状态   │
│  GET  /api/games       ─► 获取游戏列表   │
│  GET  /api/users       ─► 获取用户列表   │
│  POST /api/add-user    ─► 添加用户       │
│  GET  /api/words       ─► 获取词库       │
│  POST /api/words       ─► 保存词库       │
│  GET  /start           ─► 开始字字大冒险  │
└─────────────────────────────────────────┘
```

## 文件组织结构

```
mini-game/
│
├── 📂 templates/           ← 视图层（前端页面）
│   ├── index.html         
│   ├── login.html         
│   ├── word-quest.html    
│   ├── multiplication-game.html
│   ├── admin.html         
│   └── user-management.html
│
├── 📂 static/              ← 静态资源层
│   ├── css/               
│   └── js/                
│
├── 📄 app.py              ← 控制层 + 业务逻辑层
│   ├── 路由定义
│   ├── API 实现
│   ├── 业务逻辑
│   └── 数据库操作
│
├── 📄 config.py           ← 配置层
│   └── 数据库配置
│
├── 📄 word_list.json      ← 数据层（词库）
│
└── 📂 docs/               ← 文档层
    ├── README.md
    ├── PROJECT_STRUCTURE.md
    ├── QUICKSTART.md
    └── ARCHITECTURE.md (本文件)
```

## 扩展点

### 添加新游戏
```
1. 创建 templates/new-game.html
2. 在 app.py 的 GAMES 列表添加配置
3. 在 app.py 添加路由函数
4. (可选) 添加游戏专属 API
```

### 添加新 API
```
1. 在 app.py 定义路由 @app.route('/api/xxx')
2. 实现业务逻辑
3. 返回 JSON 数据
4. 前端调用 fetch('/api/xxx')
```

### 添加数据库表
```
1. 创建 SQL 脚本
2. 在 config.py 配置
3. 在 app.py 添加数据库操作函数
4. 创建对应的 API
```

## 部署架构（生产环境）

```
┌─────────────┐
│   Nginx     │  ← 反向代理 + 静态文件服务
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Gunicorn  │  ← WSGI 服务器
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Flask App │  ← Python 应用
└──────┬──────┘
       │
   ┌───┴────┐
   ▼        ▼
┌──────┐  ┌────────┐
│ MySQL│  │ Redis  │  ← 数据存储 + 缓存
└──────┘  └────────┘
```

## 总结

这个架构提供了：
- ✅ 清晰的分层结构
- ✅ 模块化的设计
- ✅ 易于扩展的游戏系统
- ✅ 统一的认证机制
- ✅ RESTful 风格的 API
- ✅ 完善的数据管理
